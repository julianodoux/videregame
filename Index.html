<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Sorvetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro", "Roboto", Arial, sans-serif;
        background: #f2f2f7;
        padding: 12px;
        color: #333;
        max-width: 480px;
        margin: auto;
    }

    h1 {
        text-align: center;
        font-weight: 700;
        color: #111;
    }

    .section {
        background: #fff;
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    input[type="number"], input[type="text"] {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-top: 6px;
        margin-bottom: 12px;
    }

    button {
        width: 100%;
        padding: 13px;
        border: none;
        border-radius: 12px;
        font-size: 17px;
        margin-top: 10px;
        cursor: pointer;
        font-weight: 600;
        background: #007aff;
        color: white;
    }

    .popup {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.45);
        display: none;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .popup-content {
        background: white;
        padding: 20px;
        border-radius: 14px;
        width: 100%;
        max-width: 420px;
        max-height: 80%;
        overflow-y: auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }

    .popup button {
        width: auto;
        margin-right: 10px;
    }
</style>
</head>
<body>

<h1>Controle de Vendas</h1>

<div class="section">
    <label><b>Seu nome no relatório:</b></label>
    <input type="text" id="nomeRelatorio" placeholder="Ex: Zayan">
</div>

<div class="section">
    <h2>Sorvetes</h2>
    <label>Picolé simples (R$ 4):</label>
    <input type="number" id="quant1" value="0">

    <label>Picolé especial (R$ 6):</label>
    <input type="number" id="quant2" value="0">

    <label>Sorvete 300ml (R$ 8):</label>
    <input type="number" id="quant3" value="0">

    <label>Sorvete 500ml (R$ 10):</label>
    <input type="number" id="quant4" value="0">

    <button onclick="calcular()">Atualizar Total</button>
</div>

<div class="section">
    <h2>Pagamento</h2>
    <label>Dinheiro recebido:</label>
    <input type="number" id="campoDinheiro" value="0" oninput="atualizarFinanceiro()">

    <p><b>Cartão:</b> <span id="campoCartao">R$ 0.00</span></p>
    <p><b>Comissão:</b> <span id="campoComissao">R$ 0.00</span></p>
</div>

<button onclick="abrirPopupRelatorio()">Gerar Relatório</button>

<!-- POPUP -->
<div class="popup" id="popupRelatorio">
    <div class="popup-content">
        <pre id="textoRelatorio" style="white-space: pre-wrap; font-size: 15px;"></pre>

        <button onclick="copiarRelatorio()">Copiar Texto</button>
        <button onclick="enviarWhatsApp()">Enviar WhatsApp</button>
        <button onclick="fecharPopup()">Fechar</button>
    </div>
</div>

<script>
let total = 0;
let dinheiro = 0;
let cartao = 0;
let comissao = 0;

function calcular() {
    let q1 = Number(document.getElementById("quant1").value);
    let q2 = Number(document.getElementById("quant2").value);
    let q3 = Number(document.getElementById("quant3").value);
    let q4 = Number(document.getElementById("quant4").value);

    total = q1*4 + q2*6 + q3*8 + q4*10;

    atualizarFinanceiro();
}
function atualizarFinanceiro() {
    dinheiro = Number(document.getElementById("campoDinheiro").value) || 0;

    cartao = total - dinheiro;
    if (cartao < 0) cartao = 0;

    // Desconto de 5% no cartão
    let cartaoLiquido = cartao * 0.95;

    // Comissão de 30% SOMENTE sobre dinheiro + cartão líquido
    let base = dinheiro + cartaoLiquido;
    comissao = base * 0.30;

    document.getElementById("campoCartao").innerText = "R$ " + cartao.toFixed(2);
    document.getElementById("campoComissao").innerText = "R$ " + comissao.toFixed(2);
}

function abrirPopupRelatorio() {
    gerarRelatorio();
    document.getElementById("popupRelatorio").style.display = "flex";
}

function fecharPopup() {
    document.getElementById("popupRelatorio").style.display = "none";
}

function gerarRelatorio() {
    let nome = document.getElementById("nomeRelatorio").value || "Vendedor";
    let data = new Date();
    let dia = String(data.getDate()).padStart(2, "0");
    let mes = String(data.getMonth()+1).padStart(2, "0");
    let ano = data.getFullYear();

    // Recalcular comissão
    let cartaoLiquido = cartao * 0.95;
    let base = dinheiro + cartaoLiquido;
    let comissaoCalc = base * 0.30;

    let texto = "";
    texto += `RELATÓRIO DIA ${dia}/${mes}/${ano}\n`;
    texto += `\n**${nome.toUpperCase()}**\n\n`;

    texto += `TOTAL VENDIDO: R$ ${total.toFixed(2)}\n`;
    texto += `DINHEIRO: R$ ${dinheiro.toFixed(2)}\n`;
    texto += `CARTÃO: R$ ${cartao.toFixed(2)}\n`;
    texto += `CARTÃO (–5%): R$ ${cartaoLiquido.toFixed(2)}\n`;
    texto += `BASE P/ COMISSÃO: R$ ${base.toFixed(2)}\n`;
    texto += `COMISSÃO (30%): R$ ${comissaoCalc.toFixed(2)}\n`;

    document.getElementById("textoRelatorio").innerText = texto;
}

function copiarRelatorio() {
    let texto = document.getElementById("textoRelatorio").innerText;
    navigator.clipboard.writeText(texto);
    alert("Relatório copiado!");
}

function enviarWhatsApp() {
    let texto = encodeURIComponent(document.getElementById("textoRelatorio").innerText);
    let url = "https://wa.me/?text=" + texto;
    window.open(url, "_blank");
}
</script>

</body>
</html>