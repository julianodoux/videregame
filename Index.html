<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Sistema de Sorvetes</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f1f5f9;
        margin: 0;
        padding: 0;
    }

    .container {
        width: 100%;
        max-width: 500px;
        margin: auto;
        padding: 15px;
    }

    h2 {
        margin-top: 25px;
        background: #1e40af;
        padding: 12px;
        color: white;
        text-align: center;
        border-radius: 6px;
        font-size: 20px;
    }

    .item {
        background: white;
        padding: 12px;
        margin: 10px 0;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .name {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .controls input {
        width: 60px;
        padding: 5px;
        font-size: 18px;
        text-align: center;
    }

    button {
        width: 36px;
        height: 36px;
        font-size: 22px;
        border: none;
        border-radius: 6px;
        background: #1e3a8a;
        color: white;
    }

    .red {
        background: #dc2626 !important;
        color: white;
    }

    #totaisBox {
        margin-top: 25px;
        padding: 15px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    #limpar {
        background: #b91c1c;
        width: 100%;
        padding: 12px;
        margin-top: 15px;
        border-radius: 6px;
        color: white;
        font-size: 18px;
    }
</style>
</head>
<body>

<div class="container">

<h2>PALETAS FRUTVERÃO</h2>

<div id="lista"></div>

<div id="totaisBox">
    <p><b>Total em vendas:</b> R$ <span id="totalVendas">0.00</span></p>

    <label>Dinheiro:</label>
    <input type="number" id="dinheiro" value="0" oninput="atualizarPagamento()">

    <label>Cartão:</label>
    <input type="number" id="cartao" value="0" readonly>

    <p><b>Comissão:</b> R$ <span id="comissao">0.00</span></p>

    <button id="limpar" onclick="limparTudo()">LIMPAR TUDO</button>
</div>

</div>

<script>
/* ==========================
   LISTA DE ITENS + PREÇOS
========================== */

const itens = [
    { nome: "PALETA MORANGO", preco: 18 },
    { nome: "PALETA COCO", preco: 18 },
    { nome: "PALETA UVA", preco: 18 },
    { nome: "PALETA MANGA", preco: 18 },
    { nome: "PALETA ABACAXI", preco: 18 },
    { nome: "PALETA CHOCOLATE", preco: 18 },

    { nome: "AO LEITE – CHOCOLATE", preco: 8 },
    { nome: "AO LEITE – MORANGO", preco: 8 },
    { nome: "AO LEITE – COCO", preco: 8 },

    { nome: "TROPICAL – UVA", preco: 6 },
    { nome: "TROPICAL – ABACAXI", preco: 6 },
    { nome: "TROPICAL – MARACUJÁ", preco: 6 },

    { nome: "ESPECIAL – FRUTIBLITO", preco: 13 },
    { nome: "ESPECIAL – SUNDAY", preco: 13 },

    { nome: "PISTACHE", preco: 16 },
    { nome: "UNICÓRNIO", preco: 10 }
];

/* ==========================
   CARREGA DADOS DO STORAGE
========================== */
let dados = JSON.parse(localStorage.getItem("estoqueSorvete")) || {};

function salvar() {
    localStorage.setItem("estoqueSorvete", JSON.stringify(dados));
}

/* ==========================
   GERAR LISTA NA TELA
========================== */
function gerarLista() {
    const div = document.getElementById("lista");
    div.innerHTML = "";

    itens.forEach(item => {
        if (!dados[item.nome]) {
            dados[item.nome] = { estoque: 0, vendido: 0 };
        }

        const restante = dados[item.nome].estoque - dados[item.nome].vendido;

        div.innerHTML += `
            <div class="item ${restante <= 0 ? "red" : ""}">
                <div class="name">${item.nome} — R$ ${item.preco}</div>

                <div class="controls">
                    <span>Estoque:</span>
                    <input type="number" id="est_${item.nome}" value="${dados[item.nome].estoque}" 
                           oninput="atualizarEstoque('${item.nome}')">
                </div>

                <div class="controls">
                    <span>Vendido:</span>
                    <button onclick="vender('${item.nome}', -1)">-</button>
                    <span id="vend_${item.nome}">${dados[item.nome].vendido}</span>
                    <button onclick="vender('${item.nome}', 1)">+</button>
                </div>

                <p><b>Restante: <span id="res_${item.nome}">${restante}</span></b></p>
            </div>
        `;
    });

    atualizarTotal();
}

gerarLista();

/* ==========================
        FUNÇÕES
========================== */

function atualizarEstoque(nome) {
    const v = Number(document.getElementById("est_" + nome).value);
    dados[nome].estoque = v;
    salvar();
    gerarLista();
}

function vender(nome, qnt) {
    if (dados[nome].vendido + qnt < 0) return;

    dados[nome].vendido += qnt;
    salvar();
    gerarLista();
}

function atualizarTotal() {
    let total = 0;

    itens.forEach(item => {
        total += dados[item.nome].vendido * item.preco;
    });

    document.getElementById("totalVendas").innerText = total.toFixed(2);

    // Atualiza cálculo de dinheiro/cartão quando total muda
    atualizarPagamento();
}

function atualizarPagamento() {
    const total = Number(document.getElementById("totalVendas").innerText);
    const dinheiro = Number(document.getElementById("dinheiro").value);

    let cartao = total - dinheiro;
    if (cartao < 0) cartao = 0;

    document.getElementById("cartao").value = cartao.toFixed(2);

    const comissao = dinheiro * 0.30 + cartao * 0.25;
    document.getElementById("comissao").innerText = comissao.toFixed(2);
}

function limparTudo() {
    if (confirm("Tem certeza que deseja limpar tudo?")) {
        localStorage.removeItem("estoqueSorvete");
        location.reload();
    }
}
</script>

</body>
</html>